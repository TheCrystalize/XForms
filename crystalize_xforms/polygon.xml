<?xml version="1.0" encoding="utf-8"?>
<user_transforms>
	<transform_def name="rE_Polygon">
		<node name="input_params">
			<real name="rE_Polygon">1</real>
			<real name="rE_Polygon_n"minval="3">3</real>
		</node>

		<node name="internal_params">
			<real name="weight" />
			<real name="n" />
			<real name="r" />
			<real name="chr" />
		</node>

		<int name="num_unit_randoms">4</int>

		<string name="winter_init_function">
			<![CDATA[
				let
					n = floor(rE_Polygon_n)
				in
					rE_Polygon_init_result(rE_Polygon / (0.4 + epsilon()), n, twopi() / n, 2.0 * cos(pi() / n))
			]]>
		</string>

		<string name="winter_eval_function">
			<![CDATA[
				let
					max = 0.4 + epsilon()
					sr = sqrt(unit_rnd_0) * 2.0 * max
					sa = unit_rnd_1 * twopi()
					st = vec2(cos(sa), sin(sa)) * sr / chr

					l = length(st)
					a = atan2(st.y, st.x) + pi()
					d0 = cos(floor(0.5 + a / r) * r - a) * l
					d = smoothstep(0.4, max, cos(floor(0.5 + a / r) * r - a) * l)

					rn = r * floor(unit_rnd_2 * n)
					p = vec2(-max, cos(a) * 2.0 * sin(r * 0.5) * max / chr)
					pa = atan2(p.y, p.x) + rn
				in
					if(d < l, st, vec2(cos(pa), sin(pa)) * length(p)) * weight
			]]>
		</string>
	</transform_def>


</user_transforms>
